/**
* @license
* backbone-request 99xp
* ----------------------------------
* v1.1.0
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-request.99xp.org
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("backbone"),require("underscore-99xp"),require("https"),require("http")):"function"==typeof define&&define.amd?define(["exports","backbone","underscore-99xp","https","http"],t):t((e=e||self).BackboneRequest={},e.Backbone,e._,e.https,e.http)}(this,function(e,t,r,a,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,n=n&&n.hasOwnProperty("default")?n.default:n;var s=function(e){if(e.url)return/https/.test(e.url)?a:n},o=function(e){try{return JSON.parse(e)}catch(t){return e}},u={exec:function(e,t=null,a=null){if("string"!=typeof e.url||!a&&r.size(r.pick(e,"then","catch"))<2)return!1;var n=r.defaults(r.pick(e,"url","method","headers","data","timeout"),{method:"GET",rejectUnauthorized:!1,headers:{},timeout:18e6},e.url?r.parseUrl(e.url):{});return"function"!=typeof e.then&&(e.then=((e,t,r,a)=>{a.status(e.statusCode).send(t)})),"function"!=typeof e.finally&&(e.finally=(()=>{})),"function"!=typeof e.catch&&(e.catch=((e,t,a,n)=>{try{if("object"!=typeof t)try{t=JSON.parse(t)}catch(e){t={message:t}}var s=r.isObject(e)&&e.statusCode||500;n.status(s).send(JSON.stringify(t))}catch(e){n.status(500).send(JSON.stringify({message:"Internal Failure"}))}})),n.rejectUnauthorized||(process.env.NODE_TLS_REJECT_UNAUTHORIZED=0),"GET"!==n.method&&n.data&&(n.headers["Content-Length"]=Buffer.byteLength(n.data)),new Promise(r.partial((n,u,c)=>{const d=s(n).request(r.omit(n,"data"),r=>{r.on("data",n=>{var s=o(Buffer.concat([n]).toString());/^2\d{2}/.test(r.statusCode.toString())?(e.then(r,s,t,a,e),u()):(e.catch(r,s,e,{data:s,status:r.statusCode,response:r}),c(s,r))})});d.on("error",r=>{var n;try{n=JSON.parse(r)}catch(e){n=r}e.catch(d,n,t,a,e),c(n,d)}),d.on("timeout",()=>{request.abort(),r.partial((t,r,a,n,s)=>e.catch(n,t,r,s),t,a,e)("timeout",d),c("timeout")}),"GET"!==n.method&&n.data&&d.write(n.data),d.end()},n)).catch(e=>{})},defineLib:s,parseBuffer:o},c=r.extend(r.clone(t),r.clone(u));delete c.VERSION,c.emulateHTTP=!1,c.emulateJSON=!1,c.sync=function(e,t,a){var n=d[e];r.defaults(a||(a={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON,headers:{}});var s=r.extend({},a,{type:n,dataType:"json"});a.url||(s.url=r.result(t,"url")||c.urlError()),!t||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",null==a.data?s.data=a.attrs||t.toJSON(a):s.data=a.data),a.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),!a.emulateHTTP||"PUT"!==n&&"DELETE"!==n&&"PATCH"!==n||(s.type="POST",a.emulateJSON&&(s.data._method=n),s.headers["X-HTTP-Method-Override"]=n),"GET"===s.type||a.emulateJSON||(s.processData=!1);var o=r.extend({url:s.url,method:s.type,headers:s.headers},r.omit(a,"type","dataType","emulateHTTP","emulateJSON"));return s.data&&(o.data=JSON.stringify(s.data)),o.headers["content-type"]=s.contentType||"application/json",o.then=r.partial((e,t,r,a)=>{"function"==typeof t.success&&t.success(a,r)},this,a),o.catch=r.bind(r.partial((e,t,r,a)=>{this._reqErr=r,"function"==typeof t.error&&t.error({response:r,error:a})},this,a),this),c.exec(o)};var d={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};c.urlError=function(){throw new Error('A "url" property or function must be specified')},r.map(["Events"],e=>c[e]=r.clone(t[e]));var i={Model:{initialize(e={},t={}){this.setRouterParameters(t.req,t.res)},setRouterParameters(e=null,t=null){this._req=e,this._res=t},sync(){return c.sync.apply(this,arguments)},fetchp(e,t={}){return t.success=e,this.fetch(t)},savep(e,t={}){return t.success=e,this.save(null,t)},destroyp(e,t={}){return t.success=e,this.destroy(t)}},Collection:{sync(){return c.sync.apply(this,arguments)}}};r.map(["Model","Collection"],e=>c[e]=t[e].extend(i[e])),e.default=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-request-99xp.min.js.map
