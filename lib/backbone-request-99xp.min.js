/**
* @license
* backbone-request 99xp
* ----------------------------------
* v1.2.1
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-request.99xp.org
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("backbone"),require("underscore-99xp"),require("https"),require("http")):"function"==typeof define&&define.amd?define(["exports","backbone","underscore-99xp","https","http"],t):t((e=e||self).BackboneRequest={},e.Backbone,e._,e.https,e.http)}(this,function(e,t,a,r,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var s=function(e){if(e.url)return/https/.test(e.url)?r:n},o=function(e){try{return JSON.parse(e)}catch(t){return e}},u={exec:function(e,t=null,r=null){if("string"!=typeof e.url||!r&&a.size(a.pick(e,"then","catch"))<2)return!1;var n=a.defaults({method:"GET",rejectUnauthorized:!1,headers:{"content-type":"application/json"},timeout:18e6},e.url?a.parseUrl(e.url):{}),u=a.defaults2(a.pick(e,"url","method","headers","data","timeout"),n);return"function"!=typeof e.then&&(e.then=((e,t,a,r)=>{r.status(e.statusCode).send(t)})),"function"!=typeof e.finally&&(e.finally=(()=>{})),"function"!=typeof e.catch&&(e.catch=((e,t,r,n)=>{try{if("object"!=typeof t)try{t=JSON.parse(t)}catch(e){t={message:t}}var s=a.isObject(e)&&e.statusCode||500;n.status(s).send(JSON.stringify(t))}catch(e){n.status(500).send(JSON.stringify({message:"Internal Failure"}))}})),u.rejectUnauthorized||(process.env.NODE_TLS_REJECT_UNAUTHORIZED=0),"GET"!==u.method&&u.data&&(a.isJSON(u.data)&&(u.data=JSON.stringify(u.data)),u.headers["Content-Length"]=Buffer.byteLength(u.data)),new Promise(a.partial((n,u,c)=>{const i=s(n).request(a.omit(n,"data"),a=>{a.on("data",n=>{var s=o(Buffer.concat([n]).toString());/^2\d{2}/.test(a.statusCode.toString())?(e.then(a,s,t,r,e),u()):(e.catch(a,s,e,{data:s,status:a.statusCode,response:a}),c(s,a))})});i.on("error",a=>{var n;try{n=JSON.parse(a)}catch(e){n=a}e.catch(i,n,t,r,e),c(n,i)}),i.on("timeout",()=>{request.abort(),a.partial((t,a,r,n,s)=>e.catch(n,t,a,s),t,r,e)("timeout",i),c("timeout")}),"GET"!==n.method&&n.data&&i.write(n.data),i.end()},u))},defineLib:s,parseBuffer:o},c=a.extend(a.clone(t),a.clone(u));delete c.VERSION,c.emulateHTTP=!1,c.emulateJSON=!1,c.sync=function(e,t,r){var n=i[e];a.defaults(r||(r={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON,headers:{}});var s=a.extend({},r,{type:n,dataType:"json"});r.url||(s.url=a.result(t,"url")||c.urlError()),!t||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",null==r.data?s.data=r.attrs||t.toJSON(r):s.data=r.data),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),!r.emulateHTTP||"PUT"!==n&&"DELETE"!==n&&"PATCH"!==n||(s.type="POST",r.emulateJSON&&(s.data._method=n),s.headers["X-HTTP-Method-Override"]=n),"GET"===s.type||r.emulateJSON||(s.processData=!1);var o=a.extend({url:s.url,method:s.type,headers:s.headers},a.omit(r,"type","dataType","emulateHTTP","emulateJSON"));return s.data&&(o.data=JSON.stringify(s.data)),o.headers["content-type"]=s.contentType||"application/json",o.then=a.partial((e,t,a,r)=>{"function"==typeof t.success&&t.success(r,a)},this,r),o.catch=a.bind(a.partial((e,t,a,r)=>{this._reqErr=a,"function"==typeof t.error&&t.error({response:a,error:r})},this,r),this),c.exec(o)};var i={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};c.urlError=function(){throw new Error('A "url" property or function must be specified')},a.map(["Events"],e=>c[e]=a.clone(t[e]));var d={Model:{initialize(e={},t={}){this.setRouterParameters(t.req,t.res)},setRouterParameters(e=null,t=null){this._req=e,this._res=t},sync(){return c.sync.apply(this,arguments)},fetchp(e,t={}){return t.success=e,this.fetch(t)},savep(e,t={}){return t.success=e,this.save(null,t)},destroyp(e,t={}){return t.success=e,this.destroy(t)}},Collection:{sync(){return c.sync.apply(this,arguments)}}};a.map(["Model","Collection"],e=>c[e]=t[e].extend(d[e])),e.default=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-request-99xp.min.js.map
