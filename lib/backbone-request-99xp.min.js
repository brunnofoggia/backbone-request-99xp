/**
* @license
* backbone-request 99xp
* ----------------------------------
* v1.4.2-beta
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-request.99xp.org
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("backbone"),require("app-exception"),require("backbone-99xp"),require("underscore-99xp"),require("https"),require("http")):"function"==typeof define&&define.amd?define(["exports","backbone","app-exception","backbone-99xp","underscore-99xp","https","http"],t):t((e=e||self).BackboneRequest={},e.Backbone,e.AppException,e.bbx,e._,e.https,e.http)}(this,function(e,t,r,a,n,o,s){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,s=s&&s.hasOwnProperty("default")?s.default:s;var u=function(e){if(e.url)return/https/.test(e.url)?o:s},i={exec:function(e,t=null,a=null){if("string"!=typeof e.url||!a&&n.size(n.pick(e,"then","catch"))<2)return!1;var o=n.defaults({method:"GET",rejectUnauthorized:!1,headers:{"content-type":"application/json"},timeout:18e6},e.url?n.parseUrl(e.url):{}),s=n.defaults2(n.pick(e,"url","method","headers","data","timeout"),o);return"function"!=typeof e.then&&(e.then=((e,t,a,n)=>{throw new r(JSON.stringify(t),0,e.statusCode||200)})),"function"!=typeof e.finally&&(e.finally=(()=>{})),"function"!=typeof e.catch&&(e.catch=((e,t,a,o)=>{try{if("object"!=typeof t)try{t=JSON.parse(t)}catch(e){t={message:t}}var s=n.isObject(e)&&e.statusCode||500;throw new r(JSON.stringify(t),0,s)}catch(e){throw r.internalServerError(e)}})),s.rejectUnauthorized||(process.env.NODE_TLS_REJECT_UNAUTHORIZED=0),"GET"!==s.method&&s.data&&(n.isJSON(s.data)&&(s.data=JSON.stringify(s.data)),s.headers["Content-Length"]=Buffer.byteLength(s.data)),new Promise(n.partial((r,o,s)=>{const i=u(r).request(n.omit(r,"data"),r=>{let n=[];r.setEncoding("utf8"),r.on("data",e=>{n.push(e)}),r.on("end",()=>{try{var u=n[0]instanceof Buffer||n[0]instanceof Uint8Array?Buffer.concat(n):n.join(""),i=u?JSON.parse(u):"";r.statusCode<400?o({resp:r,data:i,req:t,res:a,options:e}):s({resp:r,data:i,req:t,res:a,options:e})}catch(t){s({resp:r,options:e,output:{data:t.message,status:500}})}})});i.on("error",t=>{var r;try{r=JSON.parse(t)}catch(e){r=t}s({resp:i,message:r,options:e,output:{data:r,status:500,response:i}})}),i.on("timeout",()=>{request.abort(),n.partial((t,r,a,n,o)=>e.catch(n,t,r,o),t,a,e)("timeout",i),s("timeout")}),"GET"!==r.method&&r.data&&i.write(r.data),i.end()},s)).then(e=>{e.options.then(e.resp,e.data,e.req,e.res,e.options)}).catch(e=>{e.options.catch(e.resp,e.data,e.options,e.output)})},defineLib:u,parseBuffer:function(e){try{return JSON.parse(e)}catch(t){return e}}},p=n.extend(n.clone(t),n.clone(i));delete p.VERSION,p.emulateHTTP=!1,p.emulateJSON=!1,p.sync=function(e,t,r){var a=c[e];n.defaults(r||(r={}),{emulateHTTP:p.emulateHTTP,emulateJSON:p.emulateJSON,headers:{}});var o=n.extend({},r,{type:a,dataType:"json"});r.url||(o.url=n.result(t,"url")||p.urlError()),!t||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",null==r.data?o.data=r.attrs||t.toJSON(r):o.data=r.data),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),!r.emulateHTTP||"PUT"!==a&&"DELETE"!==a&&"PATCH"!==a||(o.type="POST",r.emulateJSON&&(o.data._method=a),o.headers["X-HTTP-Method-Override"]=a),"GET"===o.type||r.emulateJSON||(o.processData=!1);var s=n.extend({url:o.url,method:o.type,headers:o.headers},n.omit(r,"type","dataType","emulateHTTP","emulateJSON"));return o.data&&(s.data=JSON.stringify(o.data)),s.headers["content-type"]=o.contentType||"application/json",s.then=n.partial((e,t,r,a)=>{"function"==typeof t.success&&t.success(a,r)},this,r),s.catch=n.bind(n.partial((e,t,r,a)=>{this._reqErr=r,"function"==typeof t.error&&t.error({response:r,error:a})},this,r),this),p.exec(s)};var c={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};p.urlError=function(){throw r.internalServerError('A "url" property or function must be specified')},n.map(["Events"],e=>p[e]=n.clone(t[e]));var d={Model:{initialize(e={},t={}){this.setRouterParameters(t.req,t.res)},setRouterParameters(e=null,t=null){this._req=e,this._res=t},sync(){return p.sync.apply(this,arguments)},fetchp(e,t={}){return t.success=e,this.fetch(t)},savep(e,t={}){return t.success=e,this.save(null,t)},destroyp(e,t={}){return t.success=e,this.destroy(t)}},Collection:{sync(){return p.sync.apply(this,arguments)}}};n.map(["Model","Collection"],e=>p[e]=a[e.toLowerCase()].extend(d[e])),e.default=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-request-99xp.min.js.map
