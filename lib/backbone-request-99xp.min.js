/**
* @license
* backbone-request 99xp
* ----------------------------------
* v1.3.0
*
* Copyright (c)2020 Bruno Foggia, 99xp.
* Distributed under MIT license
*
* https://backbone-request.99xp.org
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("backbone"),require("underscore-99xp"),require("app-exception"),require("https"),require("http")):"function"==typeof define&&define.amd?define(["exports","backbone","underscore-99xp","app-exception","https","http"],t):t((e=e||self).BackboneRequest={},e.Backbone,e._,e.AppException,e.https,e.http)}(this,function(e,t,r,a,n,o){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o;var s=function(e){if(e.url)return/https/.test(e.url)?n:o},u=function(e){try{return JSON.parse(e)}catch(t){return e}},i={exec:function(e,t=null,n=null){if("string"!=typeof e.url||!n&&r.size(r.pick(e,"then","catch"))<2)return!1;var o=r.defaults({method:"GET",rejectUnauthorized:!1,headers:{"content-type":"application/json"},timeout:18e6},e.url?r.parseUrl(e.url):{}),i=r.defaults2(r.pick(e,"url","method","headers","data","timeout"),o);return"function"!=typeof e.then&&(e.then=((e,t,r,n)=>{throw new a(JSON.stringify(t),0,e.statusCode||200)})),"function"!=typeof e.finally&&(e.finally=(()=>{})),"function"!=typeof e.catch&&(e.catch=((e,t,n,o)=>{try{if("object"!=typeof t)try{t=JSON.parse(t)}catch(e){t={message:t}}var s=r.isObject(e)&&e.statusCode||500;throw new a(JSON.stringify(t),0,s)}catch(e){throw a.internalServerError(e)}})),i.rejectUnauthorized||(process.env.NODE_TLS_REJECT_UNAUTHORIZED=0),"GET"!==i.method&&i.data&&(r.isJSON(i.data)&&(i.data=JSON.stringify(i.data)),i.headers["Content-Length"]=Buffer.byteLength(i.data)),new Promise(r.partial((a,o,i)=>{const c=s(a).request(r.omit(a,"data"),r=>{r.on("data",a=>{var s=u(Buffer.concat([a]).toString());/^2\d{2}/.test(r.statusCode.toString())?(e.then(r,s,t,n,e),o()):(e.catch(r,s,e,{data:s,status:r.statusCode,response:r}),i(s,r))})});c.on("error",r=>{var a;try{a=JSON.parse(r)}catch(e){a=r}e.catch(c,a,t,n,e),i(a,c)}),c.on("timeout",()=>{request.abort(),r.partial((t,r,a,n,o)=>e.catch(n,t,r,o),t,n,e)("timeout",c),i("timeout")}),"GET"!==a.method&&a.data&&c.write(a.data),c.end()},i))},defineLib:s,parseBuffer:u},c=r.extend(r.clone(t),r.clone(i));delete c.VERSION,c.emulateHTTP=!1,c.emulateJSON=!1,c.sync=function(e,t,a){var n=d[e];r.defaults(a||(a={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON,headers:{}});var o=r.extend({},a,{type:n,dataType:"json"});a.url||(o.url=r.result(t,"url")||c.urlError()),!t||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",null==a.data?o.data=a.attrs||t.toJSON(a):o.data=a.data),a.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),!a.emulateHTTP||"PUT"!==n&&"DELETE"!==n&&"PATCH"!==n||(o.type="POST",a.emulateJSON&&(o.data._method=n),o.headers["X-HTTP-Method-Override"]=n),"GET"===o.type||a.emulateJSON||(o.processData=!1);var s=r.extend({url:o.url,method:o.type,headers:o.headers},r.omit(a,"type","dataType","emulateHTTP","emulateJSON"));return o.data&&(s.data=JSON.stringify(o.data)),s.headers["content-type"]=o.contentType||"application/json",s.then=r.partial((e,t,r,a)=>{"function"==typeof t.success&&t.success(a,r)},this,a),s.catch=r.bind(r.partial((e,t,r,a)=>{this._reqErr=r,"function"==typeof t.error&&t.error({response:r,error:a})},this,a),this),c.exec(s)};var d={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};c.urlError=function(){throw a.internalServerError('A "url" property or function must be specified')},r.map(["Events"],e=>c[e]=r.clone(t[e]));var l={Model:{initialize(e={},t={}){this.setRouterParameters(t.req,t.res)},setRouterParameters(e=null,t=null){this._req=e,this._res=t},sync(){return c.sync.apply(this,arguments)},fetchp(e,t={}){return t.success=e,this.fetch(t)},savep(e,t={}){return t.success=e,this.save(null,t)},destroyp(e,t={}){return t.success=e,this.destroy(t)}},Collection:{sync(){return c.sync.apply(this,arguments)}}};r.map(["Model","Collection"],e=>c[e]=t[e].extend(l[e])),e.default=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=backbone-request-99xp.min.js.map
